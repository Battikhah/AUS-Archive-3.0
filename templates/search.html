{% extends 'layout.html' %} {% block title %}Search Files | AUS Archive{% endblock %} {% block additional_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='custom.css') }}" />
{% endblock %} {% block content %}
<h1><i class="fas fa-search"></i> Search Files</h1>

<div class="card search-filters">
	<div class="card-header">
		<h2>Search Filters</h2>
	</div>
	<div class="card-body">
		<form action="{{ url_for('files.search') }}" method="post" id="searchForm">
			<div class="filters-grid">
				<div class="form-group">
					<label for="course">Course:</label>
					<select name="course" id="course" class="form-control" data-placeholder="Select a course">
						<option value=""></option>
						{% for course in courses %}
						<option value="{{ course }}">{{ course }}</option>
						{% endfor %}
					</select>
				</div>

				<div class="form-group">
					<label for="prof">Professors:</label>
					<select name="prof" id="prof" class="form-control" multiple data-placeholder="Select professor(s)">
						{% for professor in professors %}
						<option value="{{ professor }}">{{ professor }}</option>
						{% endfor %}
					</select>
				</div>

				<div class="form-group">
					<label for="file_type">File Type:</label>
					<select name="file_type" id="file_type" class="form-control" data-placeholder="Select file type">
						<option value=""></option>
						{% for file_type in file_types %}
						<option value="{{ file_type }}">{{ file_type }}</option>
						{% endfor %}
					</select>
				</div>

				<div class="form-group">
					<label for="year">Year:</label>
					<input type="number" name="year" id="year" class="form-control" min="2000" max="2100" placeholder="Year (e.g., 2023)" />
				</div>

				<div class="form-group">
					<label for="semester">Semester:</label>
					<select name="semester" id="semester" class="form-control" data-placeholder="Select semester">
						<option value=""></option>
						{% for semester in semesters %}
						<option value="{{ semester }}">{{ semester }}</option>
						{% endfor %}
					</select>
				</div>

				<div class="form-group" style="display: flex; align-items: flex-end">
					<button type="submit" class="btn btn-primary" style="width: 100%"><i class="fas fa-search"></i> Search Files</button>
				</div>
			</div>
		</form>
	</div>
</div>

{% if files %}
<div class="card">
	<div class="card-header">
		<h2><i class="fas fa-file-alt"></i> Search Results <span class="badge">{{ files|length }} files found</span></h2>
	</div>
	<div class="card-body">
		<div class="table-container">
			<table class="table-responsive">
				<thead>
					<tr>
						<th>File Name</th>
						<th>Course</th>
						<th>Professors</th>
						<th>File Type</th>
						<th>Year</th>
						<th>Semester</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for file in files %}
					<tr>
						<td>
							<a href="{{ file[8] }}" target="_blank" title="View file"> <i class="fas fa-file-pdf"></i> {{ file[1]|truncate(30) }} </a>
						</td>
						<td>{{ file[2] }}</td>
						<td>{{ file[3] }}</td>
						<td>{{ file[6] }}</td>
						<td>{{ file[4] }}</td>
						<td>{{ file[5] }}</td>
						<td>
							<div class="table-actions">
								<a href="https://drive.google.com/uc?export=download&id={{ file[7] }}" class="btn btn-primary btn-sm" title="Download file">
									<i class="fas fa-download"></i>
								</a>
								<form action="{{ url_for('main.report_file') }}" method="post" style="display: inline">
									<input type="hidden" name="file_id" value="{{ file[0] }}" />
									{% if file[10] %}
									<button type="button" class="btn btn-disabled btn-sm" disabled title="Already reported">
										<i class="fas fa-flag"></i>
									</button>
									{% else %}
									<button type="submit" class="btn btn-danger btn-sm" title="Report this file">
										<i class="fas fa-flag"></i>
									</button>
									{% endif %}
								</form>
							</div>
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
</div>
{% elif request.method == 'POST' %}
<div class="card">
	<div class="card-body">
		<div class="text-center my-3">
			<i class="fas fa-search fa-3x" style="color: #ccc"></i>
			<h3>No Results Found</h3>
			<p>Try adjusting your search filters to find what you're looking for.</p>
		</div>
	</div>
</div>
{% endif %} {% endblock %} {% block additional_scripts %}
<script>
	$(document).ready(function () {
		// Clear empty fields before form submission
		$("#searchForm").on("submit", function () {
			$("select, input").each(function () {
				if ($(this).val() === "" || $(this).val() === null) {
					$(this).prop("disabled", true);
				}
			});
			return true;
		});
	});
</script>
{% endblock %}
