{% extends 'layout.html' %}

{% block title %}Upload File | AUS Archive{% endblock %}

{% block additional_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='custom.css') }}">
<style>
.upload-container {
    max-width: 800px;
    margin: 0 auto;
}

.file-upload {
    border: 2px dashed rgba(0, 0, 0, 0.1);
    border-radius: var(--border-radius);
    padding: 2rem;
    text-align: center;
    margin: 1rem 0;
    transition: all 0.3s;
}

.file-upload:hover {
    border-color: var(--primary-color);
}

.file-upload-icon {
    font-size: 3rem;
    color: var(--primary-color);
    margin-bottom: 1rem;
}

.file-upload input[type="file"] {
    display: none;
}

.file-upload-label {
    cursor: pointer;
    color: var(--primary-color);
    font-weight: 500;
}

.selected-file-name {
    margin-top: 1rem;
    font-style: italic;
    display: none;
}

.upload-guidelines {
    background-color: rgba(40, 167, 69, 0.1);
    border-left: 4px solid var(--success-color);
    padding: 1rem;
    margin: 1rem 0;
    border-radius: var(--border-radius);
}
</style>
{% endblock %}

{% block content %}
<h1><i class="fas fa-upload"></i> Upload File</h1>

{% if not session.get('google_id') %}
<div class="card">
    <div class="card-body text-center">
        <i class="fas fa-lock fa-3x" style="color: var(--secondary-color); margin-bottom: 1rem;"></i>
        <h2>Authentication Required</h2>
        <p>Please log in with your Google account to upload files.</p>
        <a href="{{ url_for('auth.login') }}" class="btn btn-primary my-3">
            <i class="fab fa-google"></i> Sign in with Google
        </a>
    </div>
</div>
{% else %}
<div class="card">
    <div class="card-header">
        <h2><i class="fas fa-file-upload"></i> Share Your Academic Resources</h2>
    </div>
    <div class="card-body">
        <div class="upload-container">
            <div class="upload-guidelines">
                <h3><i class="fas fa-info-circle"></i> Upload Guidelines</h3>
                <ul>
                    <li>Files should be related to AUS academic courses</li>
                    <li>Ensure you have the right to share this material</li>
                    <li>Complete all fields with accurate information</li>
                    <li>Acceptable formats: PDF, DOCX, PPTX, etc.</li>
                </ul>
            </div>
            
            <form action="{{ url_for('files.upload_file') }}" method="post" enctype="multipart/form-data" id="uploadForm">
                <div class="filters-grid">
                    <div class="form-group">
                        <label for="course">Course Code <span style="color:red">*</span></label>
                        <select name="course" id="course" class="form-control" required data-placeholder="Select a course">
                            <option value=""></option>
                            {% for course in courses %}
                            <option value="{{ course }}">{{ course }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="profs">Professors <span style="color:red">*</span></label>
                        <select name="profs" id="profs" class="form-control" multiple required data-placeholder="Select professor(s)">
                            {% for professor in professors %}
                            <option value="{{ professor }}">{{ professor }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="file_type">File Type <span style="color:red">*</span></label>
                        <select name="file_type" id="file_type" class="form-control" required data-placeholder="Select file type">
                            <option value=""></option>
                            {% for file_type in file_types %}
                            <option value="{{ file_type }}">{{ file_type }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="year">Year <span style="color:red">*</span></label>
                        <input type="number" name="year" id="year" class="form-control" min="1997" max="2100" required placeholder="Enter year (e.g., 2023)">
                    </div>

                    <div class="form-group">
                        <label for="semester">Semester <span style="color:red">*</span></label>
                        <select name="semester" id="semester" class="form-control" required data-placeholder="Select semester">
                            <option value=""></option>
                            {% for semester in semesters %}
                            <option value="{{ semester }}">{{ semester }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="file-upload" id="dropZone">
                        <div class="file-upload-icon">
                            <i class="fas fa-file-upload"></i>
                        </div>
                        <label for="file" class="file-upload-label">
                            <strong>Choose a file</strong> or drag it here
                        </label>
                        <input type="file" name="file" id="file" required accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.zip">
                        <div class="selected-file-name" id="fileName"></div>
                    </div>
                </div>
                
                <div class="form-group text-center">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-cloud-upload-alt"></i> Upload File
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block additional_scripts %}
<script>
$(document).ready(function() {
    // File upload UI enhancement
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('file');
    const fileName = document.getElementById('fileName');
    
    // Click the hidden file input when the drop zone is clicked
    dropZone.addEventListener('click', () => {
        fileInput.click();
    });
    
    // Handle file selection
    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            fileName.textContent = fileInput.files[0].name;
            fileName.style.display = 'block';
            dropZone.style.borderColor = 'var(--success-color)';
        }
    });
    
    // Drag and drop functionality
    ['dragover', 'dragenter'].forEach(eventName => {
        dropZone.addEventListener(eventName, (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'var(--primary-color)';
            dropZone.style.backgroundColor = 'rgba(0, 86, 179, 0.05)';
        });
    });
    
    ['dragleave', 'dragend'].forEach(eventName => {
        dropZone.addEventListener(eventName, (e) => {
            e.preventDefault();
            dropZone.style.borderColor = 'rgba(0, 0, 0, 0.1)';
            dropZone.style.backgroundColor = 'transparent';
        });
    });
    
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = 'var(--success-color)';
        dropZone.style.backgroundColor = 'rgba(40, 167, 69, 0.05)';
        
        if (e.dataTransfer.files.length) {
            fileInput.files = e.dataTransfer.files;
            fileName.textContent = e.dataTransfer.files[0].name;
            fileName.style.display = 'block';
        }
    });
    
    // Form validation
    $('#uploadForm').on('submit', function(e) {
        let valid = true;
        const requiredFields = ['course', 'file_type', 'year', 'semester', 'file'];
        
        requiredFields.forEach(field => {
            const input = document.getElementById(field);
            if (!input.value) {
                valid = false;
                input.classList.add('error');
            }
        });
        
        // Check professors (multiple select)
        const profsSelect = document.getElementById('profs');
        if (!Array.from(profsSelect.selectedOptions).length) {
            valid = false;
            profsSelect.classList.add('error');
        }
        
        if (!valid) {
            e.preventDefault();
            alert('Please fill all required fields');
        }
    });
});
</script>
{% endblock %}
			</nav>
		</footer>
	</body>
</html>
